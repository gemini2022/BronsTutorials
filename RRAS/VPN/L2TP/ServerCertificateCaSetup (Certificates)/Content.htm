<html>
	<head>
		<title>Content</title>
	</head>
  	<body>
	
    <table width="100%" border="0" cellpadding="10">
            <tr>
                <td width="100%" align="left" valign="top"><p>A certificate infrastructure is a requirement for VPN connections based on Secure Socket Tunneling Protocol (L2TP). Certificates provide stronger authentication security than password-based authentication does. To learn about what certificates to use for a L2TP VPN connection and how to set it up, proceed with the following steps...</p></td>
                
                
          </tr>
        </table>
        
        
    	<hr>
    
        <table width="100%" border="0">
            <tr>
                <td width="100%" align="left" valign="top"><ul>
                  <li><span dir="LTR">Before we do any configuring or installation on the VPN server, we first need to choose the certificate that will be used for server authentication. To do this, first log onto the server that's running the Certification Authority service and then go to&nbsp;<strong>'Start'</strong>&nbsp;at the bottom left corner of your screen.</span></li>
    </ul>                  <br></td>
                
                <td align="right">
                    <table width="405" border="0">
                        <tr>
                            <td align="center"><img src="../../../../ActiveDirectory/InstallingActiveDirectory/AddingActiveDirectoryDomainServices/1.jpg" width="278" height="128"></td>
                        </tr>
                  </table>
              </td>
          </tr>
        </table>
        
        <hr> 
   
		<table width="100%" border="0">
            <tr>
                <td width="100%" align="left" valign="top"><ul>
                  <li><span dir="LTR">And then  go to <strong>'Administrative Tools'</strong>...</span></li>
                </ul></td>
                
                <td align="right">
                  <table width="405" border="0">
                        <tr>
                            <td align="center"><img src="../../../../ActiveDirectory/InstallingActiveDirectory/AddingActiveDirectoryDomainServices/2.jpg" width="405" height="456"></td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
        
        <hr> 
		
        <table width="100%" border="0">
            <tr>
                <td width="100%" align="left" valign="top"><ul>
                  <li><span dir="LTR">Then <strong>'Certification Authority'</strong>...</span></li>
                </ul></td>
                
                <td align="right">
              <table width="405" border="0">
                        <tr>
                            <td align="center"><img src="../../../../Certificates/SettingUpTwoTierPkiHierarchy/SetDomainNamespaceForOfflineRootCa/11.jpg" width="252" height="406"></td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
        
        <hr> 
        
        <table width="100%" border="0">
            <tr>
                <td width="100%" align="left" valign="top"><ul>
            <li><span dir="LTR">Once in Certification Authority, expand the root node for the CA</span>, which in this case is&nbsp;<strong>'EnterpirseCA'</strong>.</li></ul></td>
                
                <td align="right">
              <table width="405" border="0">
                        <tr>
                            <td align="center"><img src="../../../../Certificates/Autoenrollment/GroupPolicy/CreateDuplicateTemplate/6.jpg" width="419" height="135"></td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
        
        <hr>
        
        <table width="100%" border="0">
            <tr>
                <td width="100%" align="left" valign="top"><ul>
                  <li><span dir="LTR"><span dir="LTR">Then right-click&nbsp;<strong>'Certificate Templates'</strong>.</span></span></li>
            </ul></td>
                
                <td align="right">
              <table width="405" border="0">
                        <tr>
                            <td align="center"><img src="../../../../Certificates/Autoenrollment/GroupPolicy/CreateDuplicateTemplate/7.jpg" width="360" height="192"></td>
                        </tr>
                  </table>
                </td>
            </tr>
        </table>
        
        <hr>
        
        <table width="100%" border="0">
            <tr>
                <td width="100%" align="left" valign="top"><ul>
                  <li><span dir="LTR"><span dir="LTR">And select&nbsp;<strong>'Manage'</strong>.</span></span></li>
        </ul></td>
                
                <td align="right">
              <table width="405" border="0">
                        <tr>
                            <td align="center"><img src="../../../../Certificates/Autoenrollment/GroupPolicy/CreateDuplicateTemplate/8.jpg" width="82" height="101"></td>
                        </tr>
                  </table>
                </td>
            </tr>
        </table>
       
       <hr>
        
        <table width="100%" border="0">
            <tr>
                <td width="100%" align="left" valign="top"><ul>
                  <li>Now, we need to find the appropriate certificate that we will use for the VPN server. The certificate you install on the VPN server must have either the Server Authentication or All-Purpose enhanced key usage (EKU) property. This  certificate is used by the VPN client to authenticate the VPN server when the session is established. In this case, we will choose the certificate <strong>'RAS and IAS Server'</strong>, which has the Server Authentication property. Once this certificate is located, right-click it.</li>
            </ul></td>
                
                <td align="right">
              <table width="405" border="0">
                        <tr>
                            <td align="center"><img src="../../SSTP/ServerCertificateCaSetup/1.jpg" width="876" height="670"></td>
                        </tr>
                  </table>
                </td>
            </tr>
        </table>
        
        <hr>
        
        <table width="100%" border="0">
            <tr>
                <td width="100%" align="left" valign="top"><ul>
                  <li><span dir="LTR">And select <strong>'Properties'</strong>.</span></li>
            </ul></td>
                
                <td align="right">
              <table width="405" border="0">
                        <tr>
                            <td align="center"><img src="../../../../Certificates/SmartCardCertificateEnrollment/IdentifyEnrollmentAgent/2.jpg" width="135" height="101"></td>
                        </tr>
                  </table>
                </td>
            </tr>
        </table>
        
        <hr>
        
        <table width="100%" border="0">
            <tr>
                <td width="100%" align="left" valign="top"><ul>
                  <li><span dir="LTR">Once in the properties of the 'RAS and IAS Server' certificate, select the <strong>'Security'</strong> tab.</span></li>
            </ul></td>
                
                <td align="right">
              <table width="405" border="0">
                        <tr>
                            <td align="center"><img src="../../SSTP/ServerCertificateCaSetup/2.jpg" width="404" height="539"></td>
                        </tr>
                  </table>
                </td>
            </tr>
        </table>
        
        <hr>
        
        <table width="100%" border="0">
            <tr>
                <td width="100%" align="left" valign="top"><ul>
                  <li><span dir="LTR">It is here where we need to make sure that our VPN server is eligible</span> to enroll for this certificate. By default, this certificate already contains a group  called <strong>'RAS and IAS Servers'</strong>. Our VPN server is already a member of this group, therefore as long as this group is eligible to enroll for this certificate, then enrolling for this certificate should be succesful.</li>
            </ul></td>
                
                <td align="right">
              <table width="405" border="0">
                        <tr>
                            <td align="center"><img src="../../SSTP/ServerCertificateCaSetup/3a.jpg" width="404" height="522"></td>
                        </tr>
                  </table>
                </td>
            </tr>
        </table>
        
        <hr>
        
        <table width="100%" border="0">
            <tr>
                <td width="100%" align="left" valign="top"><ul>
                  <li><span dir="LTR">To make sure that this group is eligible for enrollment</span>, select it.</li>
            </ul></td>
                
                <td align="right">
              <table width="405" border="0">
                        <tr>
                            <td align="center"><img src="../../SSTP/ServerCertificateCaSetup/3b.jpg" width="439" height="522"></td>
                        </tr>
                  </table>
                </td>
            </tr>
        </table>
        
        <hr>
        
        <table width="100%" border="0">
            <tr>
                <td width="100%" align="left" valign="top"><ul>
                  <li><span dir="LTR">And make sure that the permission for <strong>'Enroll'</strong> is set to <strong>'Allow'</strong>, which in this case it is.</span></li>
            </ul></td>
                
                <td align="right">
              <table width="405" border="0">
                        <tr>
                            <td align="center"><img src="../../SSTP/ServerCertificateCaSetup/4.jpg" width="404" height="522"></td>
                        </tr>
                  </table>
                </td>
            </tr>
        </table>
        
        <hr>
        
        <table width="100%" border="0">
            <tr>
                <td width="100%" align="left" valign="top"><ul>
                  <li>Next, select the <strong>'Subject Name'</strong> tab.</li>
            </ul></td>
                
                <td align="right">
              <table width="405" border="0">
                        <tr>
                            <td align="center"><img src="../../SSTP/ServerCertificateCaSetup/5.jpg" width="404" height="539"></td>
                        </tr>
                  </table>
                </td>
            </tr>
        </table>
        
        <hr>
        
        <table width="100%" border="0">
            <tr>
                <td width="100%" align="left" valign="top"><ul>
                  <li><span dir="LTR">Instead of having the subject name of the certificate built from Active Directory.</span></li>
            </ul></td>
                
                <td align="right">
              <table width="405" border="0">
                        <tr>
                            <td align="center"><img src="../../SSTP/ServerCertificateCaSetup/6.jpg" width="404" height="522"></td>
                        </tr>
                  </table>
                </td>
            </tr>
        </table>
        
        <hr>
        
        <table width="100%" border="0">
            <tr>
                <td width="100%" align="left" valign="top"><ul>
                  <li><span dir="LTR">Select the option <strong>'Supply in the request'</strong>. This will allow when enrolling for the certificate to manually provide the subject name of the certificate. Doing this will demonstrate what the subject name needs to be and why.</span></li>
            </ul></td>
                
                <td align="right">
              <table width="405" border="0">
                        <tr>
                            <td align="center"><img src="../../SSTP/ServerCertificateCaSetup/7.jpg" width="443" height="522"></td>
                        </tr>
                  </table>
                </td>
            </tr>
        </table>
        
        <hr>
        
        <table width="100%" border="0">
            <tr>
                <td width="100%" align="left" valign="top"><ul>
                  <li><span dir="LTR">Once the option 'Supply in the request' is selected, we immediately get a dialogue box warning us that this option may create a security risk and is not recommended.</span>&nbsp;This is because with this option, it allows a client to submit a certificate request using any subject name and does not require approval by a certificate manager.</li>
                  <br>
                  <li>Press&nbsp;<strong>'OK'</strong>.</li>
        </ul></td>
                
                <td align="right">
              <table width="405" border="0">
                        <tr>
                            <td align="center"><img src="../../../../Certificates/CertificateTemplates/DuplicateTemplate/SubjectNameTab/2.jpg" width="414" height="178"></td>
                        </tr>
                  </table>
                </td>
            </tr>
        </table>
        
        <hr>
        
        <table width="100%" border="0">
            <tr>
                <td width="100%" align="left" valign="top"><ul>
                  <li>Press&nbsp;<strong>'OK'</strong> to commit to the changes.</li>
          </ul></td>
                
                <td align="right">
              <table width="405" border="0">
                        <tr>
                            <td align="center"><img src="../../SSTP/ServerCertificateCaSetup/8.jpg" width="404" height="522"></td>
                        </tr>
                  </table>
                </td>
            </tr>
        </table>
        
        <hr>
        
        <table width="100%" border="0">
            <tr>
                <td width="100%" align="left" valign="top"><ul>
                  <li><span dir="LTR">Then close the 'Certificate Templates Console'.</span></li>
            </ul></td>
                
                <td align="right">
              <table width="405" border="0">
                        <tr>
                            <td align="center"><img src="../../SSTP/ServerCertificateCaSetup/9.jpg" width="876" height="670"></td>
                        </tr>
                  </table>
                </td>
            </tr>
        </table>
        
        <hr>
        
        <table width="100%" border="0">
            <tr>
                <td width="100%" align="left" valign="top"><ul>
                  <li><span dir="LTR">Now that the certificate is configured, we need to </span>issue the certificate so it can be used. To do this, right-click <strong>'Certificate Templates'</strong>.</li>
            </ul></td>
                
                <td align="right">
              <table width="405" border="0">
                        <tr>
                            <td align="center"><img src="../../../../Certificates/Autoenrollment/GroupPolicy/CreateDuplicateTemplate/7.jpg" width="360" height="192"></td>
                        </tr>
                  </table>
                </td>
            </tr>
        </table>
        
        <hr>
        
        <table width="100%" border="0">
            <tr>
                <td width="100%" align="left" valign="top"><ul>
                  <li><span dir="LTR">Then select <strong>'New'</strong>.</span></li>
            </ul></td>
                
                <td align="right">
              <table width="405" border="0">
                        <tr>
                            <td align="center"><img src="../../../../Certificates/Autoenrollment/GroupPolicy/PublishDuplicateTemplate/1.jpg" width="82" height="101"></td>
                        </tr>
                  </table>
                </td>
            </tr>
        </table>
        
        <hr>
        
        <table width="100%" border="0">
            <tr>
                <td width="100%" align="left" valign="top"><ul>
                  <li><span dir="LTR">And then <strong>'Certificate Template to Issue'</strong>.</span></li>
            </ul></td>
                
                <td align="right">
              <table width="405" border="0">
                        <tr>
                            <td align="center"><img src="../../../../Certificates/Autoenrollment/GroupPolicy/PublishDuplicateTemplate/2.jpg" width="183" height="23"></td>
                        </tr>
                  </table>
                </td>
            </tr>
        </table>
        
        <hr>
        
        <table width="100%" border="0">
            <tr>
                <td width="100%" align="left" valign="top"><ul>
                  <li><span dir="LTR"><span dir="LTR">After selecting the option 'Certificate Template to Issue', a list of the preconfigured certificate templates will appear. Among this list, is the certificate template</span></span>&nbsp;we edited earlier&nbsp;<strong>'RAS and IAS Server'</strong>. In this case, to get to it, we need to scroll down the list.</li>
        </ul></td>
                
                <td align="right">
              <table width="405" border="0">
                        <tr>
                            <td align="center"><img src="../../../../Certificates/Autoenrollment/GroupPolicy/PublishDuplicateTemplate/3.jpg" width="587" height="366"></td>
                        </tr>
                  </table>
                </td>
            </tr>
        </table>
        
        <hr>
        
        <table width="100%" border="0">
            <tr>
                <td width="100%" align="left" valign="top"><ul>
                  <li>Once the template is located, select it.</li>
        </ul></td>
                
                <td align="right">
              <table width="405" border="0">
                        <tr>
                            <td align="center"><img src="../../SSTP/ServerCertificateCaSetup/10.jpg" width="587" height="366"></td>
                        </tr>
                  </table>
                </td>
            </tr>
        </table>
        
        <hr>
        
        <table width="100%" border="0">
            <tr>
                <td width="100%" align="left" valign="top"><ul>
                  <li><span dir="LTR"><span dir="LTR">Then press&nbsp;<strong>'OK'</strong>.</span></span></li>
        </ul></td>
                
                <td align="right">
              <table width="405" border="0">
                        <tr>
                            <td align="center"><img src="../../SSTP/ServerCertificateCaSetup/11.jpg" width="587" height="366"></td>
                        </tr>
                  </table>
                </td>
            </tr>
        </table>
        
        <hr>
        
        <table width="100%" border="0">
            <tr>
                <td width="100%" align="left" valign="top"><ul>
              <li>And now you can see our certificate template&nbsp;<strong>'RAS and IAS Server'</strong>&nbsp;is in the list and ready to use.</li></ul></td>
                
                <td align="right">
              <table width="405" border="0">
                        <tr>
                            <td align="center"><img src="../../SSTP/ServerCertificateCaSetup/12.jpg" width="521" height="301"></td>
                        </tr>
                  </table>
                </td>
            </tr>
        </table>
       
    </body>
</html>